<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Package Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'JetBrains Mono', monospace !important;
        }
    </style>
</head>
<body class="m-0 p-0 h-screen bg-black text-white flex">
    <div id="recentProjectsSidebar" class="fixed left-0 top-0 h-screen w-[360px] 2xl:w-[480px] border-r border-white/10 overflow-y-auto bg-transparent z-40">
        <ul id="recentProjectsList" class="w-full"></ul>
    </div>
    <!-- Spacer div for sidebar width on small screens -->
    <div id="recentProjectsSidebarSpacer" class="block 2xl:hidden w-[360px] 2xl:w-[480px]" aria-hidden="true"></div>
    <div class="flex-1 flex justify-center items-center min-h-screen">
        <div class="text-center flex flex-col items-center w-full max-w-[450px]">
            <input id="repoInput" type="text" placeholder="Local project path e.g. /path/to/project"
                   class="px-5 py-3 text-base border-none bg-white/10 text-white w-[450px] mb-5 focus:outline-none rounded-none"
                   oninput="saveInputValue()" />
            <button onclick="navigateToGraph()" class="px-5 font-medium py-1.5 text-base bg-white text-black border-none cursor-pointer transition-colors hover:bg-gray-200 rounded-none">
                Analyze Repository
            </button>
        </div>
    </div>
    <script>
        // Load saved value when page loads
        window.addEventListener('load', function() {
            const savedValue = localStorage.getItem('repoPath');
            if (savedValue) {
                document.getElementById('repoInput').value = savedValue;
            }
            renderRecentProjects();
        });

        // Save input value to localStorage when changed
        function saveInputValue() {
            const input = document.getElementById('repoInput');
            localStorage.setItem('repoPath', input.value);
        }

        function navigateToGraph() {
            const input = document.getElementById('repoInput');
            const repoValue = input.value.trim();
            window.location.href = repoValue ? `/graph?repo=${encodeURIComponent(repoValue)}` : '/graph';
        }

        // Render recent projects list in sidebar
        function createRecentProjectListItem(proj, idx, recent, renderRecentProjects) {
            const li = document.createElement('li');
            li.className = 'flex items-center justify-between px-4 py-3 border-b border-white/10 bg-transparent hover:bg-white/10 transition cursor-pointer';
            li.title = proj.path;
            const left = document.createElement('div');
            left.className = 'flex-1 text-left truncate';
            left.innerHTML = `<span class='font-mono text-sm'>${proj.path}</span>`;
            const removeBtn = document.createElement('button');
            removeBtn.className = 'ml-3 text-white/30 hover:text-red-400 text-2xl font-bold px-2 py-0.5 rounded';
            removeBtn.title = 'Remove from recent';
            removeBtn.innerHTML = '&times;';
            removeBtn.onclick = function(e) {
                e.stopPropagation();
                let updated = recent.filter((_, i) => i !== idx);
                localStorage.setItem('recentProjects', JSON.stringify(updated));
                renderRecentProjects();
            };
            li.onclick = function(e) {
                if (e.target !== removeBtn) {
                    window.location.href = `/graph?repo=${encodeURIComponent(proj.path)}`;
                }
            };
            li.appendChild(left);
            li.appendChild(removeBtn);
            return li;
        }
        function renderRecentProjects() {
            let recent = [];
            try {
                recent = JSON.parse(localStorage.getItem('recentProjects') || '[]');
            } catch (e) { recent = []; }
            const list = document.getElementById('recentProjectsList');
            if (list) list.innerHTML = '';
            const sidebar = document.getElementById('recentProjectsSidebar');
            const sidebarSpacer = document.getElementById('recentProjectsSidebarSpacer');
            if (!recent.length) {
                if (sidebar) sidebar.style.display = 'none';
                if (sidebarSpacer) sidebarSpacer.style.display = 'none';
                return;
            } else {
                if (sidebar) sidebar.style.display = '';
                if (sidebarSpacer) sidebarSpacer.style.display = '';
            }
            recent.forEach((proj, idx) => {
                list.appendChild(createRecentProjectListItem(proj, idx, recent, renderRecentProjects));
            });
        }

        // Also update after navigation
        window.addEventListener('storage', function(e) {
            if (e.key === 'recentProjects') renderRecentProjects();
        });
    </script>
</body>
</html>
